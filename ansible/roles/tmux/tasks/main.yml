- name: Install tmux tools
  package: name={{ item }}
  with_items:
  - tmux

- name: Add tmux config
  become_user: "{{ tmux_user_id }}"
  copy:
    src: .tmux.conf
    dest: "~/"

- name: Add tmux-helper
  become_user: "{{ tmux_user_id }}"
  copy:
    src: tmux-helper.bash
    dest: "~/"

- name: Ensure Unix line endings
  become_user: "{{ tmux_user_id }}"
  replace:
    path: "{{ item }}"
    regexp: "\r\n"
    replace: "\n"
  with_items:
  - "~/tmux-helper.bash"
  - "~/.tmux.conf"

- name: Source tmux-helper
  become_user: "{{ tmux_user_id }}"
  blockinfile:
    path: "~/.bashrc"
    marker: "# {mark} ANSIBLE MANAGED BLOCK: tmux-helper"
    block: |
      if [ -f ~/tmux-helper.bash ]; then
        source ~/tmux-helper.bash
      fi
